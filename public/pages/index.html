<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartDoor - Đăng nhập</title>

  <link href="styles/index.css" rel="stylesheet" type="text/css" />
  
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
  <div class="wrapper fadeInDown">
    <div id="formContent">
      <!-- Tabs Titles -->
  
      <!-- Icon -->
      <div class="fadeIn first">
        <svg class="bi bi-person-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
        </svg>
      </div>
  
      <!-- Login Form -->
      <form method="post" id="login-form">
        <input type="text" id="username" class="fadeIn second" name="login" placeholder="Tên tài khoản"">
        <input type="text" id="password" class="fadeIn third" name="login" placeholder="Mật khẩu">
        <input type="submit" id="submit-button" class="fadeIn fourth" value="Đăng nhập">
      </form>
      <span style="height: 30px; color: brown; display: block;"></span>
  
      <!-- Remind Passowrd -->
      <div id="formFooter">
        <a class="underlineHover" href="#">Quên mật khẩu?</a>
      </div>
  
    </div>
  </div>

  <script>
    if(localStorage.getItem("username") && localStorage.getItem("isAdmin") && localStorage.getItem("password")) {
      window.location.href = "/dashboard"
    }

    let loading = false;

    $(document).ready(() => {
      $('#login-form').submit(e => {
        e.preventDefault()
        if(loading) {
          return
        }

        loading = true;
          
        const username = $('#username').val()
        const password = $('#password').val()

        if(!username || !password) {
          $( "span" ).text( "Vui lòng điền đủ các trường!" ).show().fadeOut( 5000 );
          if(!username) {
            $('#username').addClass('input-with-error')
          }

          if(!password) {
            $('#password').addClass('input-with-error')
          }

          loading = false;
          return;
        }

        $('#username').removeClass('input-with-error')
        $('#password').removeClass('input-with-error')

        $.ajax({
          method: 'POST',
          url: '/api/auth',
          data: JSON.stringify({ username, password }),
          contentType: 'application/json',
          success: () => {
            localStorage.setItem("username", username)
            localStorage.setItem("password", password)
            localStorage.setItem("isAdmin", true)

            window.location.href = "/dashboard"
          },
          error: () => {
            $( "span" ).text("Tên tài khoản hoặc mật khẩu không đúng!").show().fadeOut( 5000 );
          }
        })

        loading = false;
      })
    })
  </script>
</body>
</html>